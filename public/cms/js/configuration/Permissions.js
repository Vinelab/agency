// Generated by CoffeeScript 1.6.3
(function() {
  var Permissions;

  Permissions = (function() {
    function Permissions() {
      this.table_selector = '#permissions-table';
      this.pager_selector = '#permissions-pager';
      this.configure();
    }

    Permissions.prototype.configure = function() {
      var pager_selector, self, table_selector;
      self = this;
      table_selector = this.table_selector;
      pager_selector = this.pager_selector;
      $(table_selector).jqGrid({
        caption: "Permissions",
        url: 'configuration/permissions',
        datatype: 'json',
        mtype: 'GET',
        savekey: [true, 13],
        pager: pager_selector,
        height: 'auto',
        viewrecords: true,
        rowNum: 20,
        rowList: [20, 40, 60],
        multiselect: true,
        multiboxonly: true,
        autowidth: true,
        shrinkToFit: true,
        loadError: function(xhr, status, error) {
          throw new Error(error);
          return alert('There was an error loading permissions data. Please try again later.');
        },
        colNajems: ['ID', 'Title', 'Alias', 'Description'],
        colModel: [
          {
            name: 'id',
            index: 'id',
            width: 5,
            sorttype: 'int',
            editable: false,
            align: 'center'
          }, {
            name: 'title',
            index: 'title',
            width: 40,
            editable: true,
            editoptions: {
              size: 20,
              maxlength: 100
            }
          }, {
            name: 'alias',
            index: 'alias',
            width: 40,
            editable: true,
            editoptions: {
              size: 20,
              maxlength: 100
            }
          }, {
            name: 'description',
            index: 'description',
            width: 50,
            editable: true,
            edittype: 'textarea'
          }
        ]
      }).navGrid(pager_selector, {
        view: true,
        viewicon: 'icon-zoom-in grey',
        add: true,
        addicon: 'icon-plus-sign purple',
        edit: true,
        editicon: 'icon-pencil blue',
        del: true,
        delicon: 'icon-trash red',
        search: true,
        searchicon: 'icon-search orange',
        refresh: true,
        refreshicon: 'icon-refresh green',
        reloadAfterSubmit: true
      }, {
        editCaption: 'Edit Permission',
        mtype: 'PUT',
        recreateForm: true,
        closeAfterEdit: true,
        url: 'configuration/permissions/id',
        afterSubmit: this.permissionsChanged,
        onclickSubmit: function(params, postdata) {
          return params.url = "/cms/configuration/permissions/" + (encodeURIComponent(postdata['permissions-table_id']));
        }
      }, {
        mtype: 'POST',
        closeAfterAdd: true,
        reloadAfterSubmit: true,
        url: 'configuration/permissions',
        afterSubmit: this.permissionsChanged
      }, {
        mtype: 'DELETE',
        afterSubmit: this.permissionsChanged,
        onclickSubmit: function(params, postdata) {
          return params.url = "/cms/configuration/permissions/" + (encodeURIComponent(postdata));
        }
      }, {
        mtype: 'GET'
      }, {
        mtype: 'GET'
      });
      return $(window).on('resize', function() {
        var width;
        width = $(window).width();
        width = width - 2;
        if (width > 0 && Math.abs(width - $(table_selector).width()) > 5) {
          return $(table_selector).setGridWidth(width);
        }
      });
    };

    Permissions.prototype.permissionsChanged = function(success, message, operation) {
      if (success) {
        return window.Configuration.Roles.reload();
      }
    };

    return Permissions;

  })();

}).call(this);
